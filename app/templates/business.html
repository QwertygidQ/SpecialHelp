{% extends "base.html" %}

{% block content %}
<h1>{{ business.name }}</h1>

<div class="ui three column grid">
    <div class="ui column">
        <div class="ui medium bordered circular image">
            <img src="{{ url_for('uploads', filename=business.image.filename) }}"/>
        </div>
    </div>
    
    <div class="ui column">
        <div class="ui segment">
            <strong>Адрес:</strong><br>
            {{ business.address | nl2br }}
        </div>
        
        <div class="ui segment">
            <strong>Время работы:</strong><br>
            {{ business.time | nl2br }}
        </div>
        
        <div class="ui segment">
            <strong>Контакты:</strong><br>
            {{ business.contacts | nl2br }}
        </div>
    </div>
    
    <div class="ui column">
        <div class="ui segment">
            <strong>Теги:</strong><br>
            {% for tag in business.tags %}
                <a href="{{ url_for('tag_list_page', tag_name=tag.name, page=1) }}">{{ tag.name }}</a>&nbsp;
            {% endfor %}
        </div>
        
        <div class="ui segment">
            <strong>Оценка:</strong><br>
            {{ business.rating }}
        </div>
    </div>
</div>

<p>
    <strong>Описание:</strong><br>
    {{ business.desc | nl2br }}
</p>
{% if has_not_commented %}
    <form class="ui form" method="post">
        {{ form.hidden_tag() }}

        <div class="field">
            {{ form.rating.label }}
            {{ form.rating() }}
            {{ error_macro.print_errors(form.rating) }}
        </div>
        <div class="field">
            {{ form.comment.label }}
            {{ form.comment() }}
            {{ error_macro.print_errors(form.comment) }}
        </div>

        {{ form.submit(class_="ui button") }}
    </form>
{% elif current_user.is_authenticated %} {# Authenticated user has already commented on this business #}
    <p>
        Ваш комментарий был учтен!
    </p>
{% else %}
    <p>
        <a href="{{ url_for('signin') }}">Войдите</a> или <a href="{{ url_for('signup') }}">зарегистрируйтесь</a> для того чтобы оставить комментарий!
    </p>
{% endif %}

{% for comment in business.comments %}
    <hr>
    <strong><h3>{{ comment.author.username }}</h3></strong>
    <i>Оценка: {{ comment.rating }}</i><br>
    <p class="user-input">{{ comment.text | nl2br }}</p>
{% endfor %}
{% endblock %}
