{% extends "base.html" %}

{% block content %}
<h1>{{ business.name }}</h1>

<div class="ui stackable three column grid">
    <div class="ui column">
        <div class="ui medium bordered circular image">
            <img src="{{ url_for('uploads', filename=business.image.filename) if business.image is not none else '../static/images/default.png' }}"/>
        </div>
    </div>

    <div class="ui column">
        <div class="ui segment">
            <strong>{{ _('Address:') }}</strong><br>
            {{ business.address }}
        </div>

        <div class="ui segment">
            <strong>{{ _('Working time:') }}</strong><br>
            {{ business.time }}
        </div>

        <div class="ui segment">
            <strong>{{ _('Contacts:') }}</strong><br>
            {{ business.contacts }}
        </div>
    </div>

    <div class="ui column">
        <div class="ui segment">
            <strong>{{ _('Tags:') }}</strong><br>
            {% for tag in business.tags %}
                <a href="{{ url_for('tag_list_page', tag_name=tag.name, page=1) }}">{{ tag.name }}</a>&nbsp;
            {% endfor %}
        </div>

        <div class="ui segment">
            <strong>{{ _('Rating:') }}</strong><br>
            <div class="input-disallowed ui large star rating" data-rating="{{ business.rating }}" data-max-rating="5"></div>
        </div>
    </div>
</div>

<div class="ui segment">
    <strong>{{ _('Description') }}</strong><br>
    {{ business.desc }}
</div>

{% if has_not_commented %}
    <div class="ui segment">
        <form class="ui bottom-padded form" method="post">
            {{ form.hidden_tag() }}

            <div class="field">
                {{ form.rating.label }}
                <div class="input-allowed ui large star rating" data-rating="{{ form.rating.data }}" data-max-rating="5"></div>
                {{ error_macro.print_errors(form.rating) }}
            </div>
            <div class="field">
                {{ form.comment.label }}
                {{ form.comment() }}
                {{ error_macro.print_errors(form.comment) }}
            </div>

            {{ form.submit(class_="ui button") }}
        </form>
    </div>
{% elif current_user.is_authenticated %} {# Authenticated user has already commented on this business #}
    <p>
        {{ _('Your comment has been posted!') }}
    </p>
{% else %}
    <p>
        {% autoescape false %}
        {{ _('%(link_and_babel_for_signin)s or %(link_and_babel_for_registration)s to post a comment!',
            link_and_babel_for_signin='<a href="{}">'.format(url_for('signin', next=request.full_path)) + _('Sign in to') + '</a>',
            link_and_babel_for_registration='<a href="{}">'.format(url_for('signup')) + _('Register to') + '</a>'
            ) }}
        {% endautoescape %}
    </p>
{% endif %}

{% if business.comments.all() %}
    <h2>{{ _('Comments') }}</h2>
{% endif %}

{% for comment in business.comments %}
    <div class="ui raised segment">
        <div class="ui stackable grid">
            <div class="three wide center aligned column">
                <div class="ui small bordered circular image">
                    <img src="{{ url_for('uploads', filename=comment.author.image.filename) if comment.author.image is not none else '../static/images/default.png' }}"/>
                </div>
            </div>

            <div class="thirteen wide column">
                <h2><a href="{{ url_for('profile', username=comment.author.username) }}">{{ comment.author.username }}</a></h2>
                <div class="input-disallowed ui large star rating" data-rating="{{ comment.rating }}" data-max-rating="5"></div>
                <p class="user-input">{{ comment.text }}</p>
            </div>
        </div>
    </div>
{% endfor %}

<div class="ui bottom-padded"></div>
{% endblock %}
